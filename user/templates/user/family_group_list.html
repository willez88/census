{% extends 'base/base.html' %}
{% load auth_extra %}
{% load i18n %}

{% block breadcrumb %}
  <li class="breadcrumb-item active">Grupos Familiares</li>
{% endblock %}

{% block content %}
  <div class="card">
    <div class="card-header">
      Listar <a href="{% url 'user:family_group_create' %}" class="btn btn-success btn-sm float-right">Registrar</a>
    </div>

    <div class="card-body">
      <div class="table-responsive">
        <form id="form_activate" method="post">
          {% csrf_token %}
          <table class="table table-striped table-hover table-bordered display dataTable" id="table" style="width:100%;">
            <!-- Cabecera de la tabla (igual que antes) -->
            <thead>
              <tr>
                <th>Usuario - Grupo Familiar</th>
                <th>Correo Electrónico</th>
                <th>Departamentos - Integrantes</th>
                <th>Activar/desactivar</th>
              </tr>
            </thead>
            <!-- Cuerpo de la tabla -->
            <tbody>
              {% for family_group in page_obj %}  <!-- Cambiado object_list por page_obj -->
                <tr>
                  <!-- Contenido de cada fila (igual que antes) -->
                  <td><a href="{% url 'user:family_group_edit' family_group.id %}">{{ family_group.profile.user.username }}</a></td>
                  <td>{{ family_group.profile.user.email }}</td>
                  <td>
                    {{ family_group.department }}
                    <br>
                    {% for person in family_group.person_set.all %}
                      {{ person }} {% if person.family_head %} - Jefe familiar {% endif %}
                      <br>
                    {% endfor %}
                  </td>
                  {% if family_group.profile.user.is_active %}
                    <td>
                      <i class="far fa-thumbs-up fa-3x text-success" title="Usuario Activo" aria-hidden="true"></i>
                      <input type='checkbox' id='user-{{ family_group.profile.user.id }}' value='{{ family_group.profile.user.id }}' name='deactivate' onclick='$("#form_activate").submit();'/>
                    </td>
                  {% else %}
                    <td>
                      <i class="far fa-thumbs-down fa-3x text-danger" title="Usuario Inactivo" aria-hidden="true"></i>
                      <input type='checkbox' id='user-{{ family_group.profile.user.id }}' value='{{ family_group.profile.user.id }}' name='activate' onclick='$("#form_activate").submit();'/>
                    </td>
                  {% endif %}
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </form>

        <!-- Paginación -->
        <div class="d-flex justify-content-between align-items-center mt-3">
          <div class="text-muted">
            Mostrando {{ page_obj.start_index }} a {{ page_obj.end_index }} de {{ page_obj.paginator.count }} registros
          </div>
          <ul class="pagination mb-0">
            {% if page_obj.has_previous %}
              <li class="page-item">
                <a class="page-link" href="?page=1">&laquo; Primera</a>
              </li>
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}">Anterior</a>
              </li>
            {% endif %}
            
            {% for num in page_obj.paginator.page_range %}
              {% if page_obj.number == num %}
                <li class="page-item active">
                  <a class="page-link" href="#">{{ num }}</a>
                </li>
              {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                <li class="page-item">
                  <a class="page-link" href="?page={{ num }}">{{ num }}</a>
                </li>
              {% endif %}
            {% endfor %}
            
            {% if page_obj.has_next %}
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}">Siguiente</a>
              </li>
              <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}">Última &raquo;</a>
              </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_footer %}
  <script type="text/javascript">
    $(document).ready(function() {
      // Configuración de DataTable sin paginación propia
      var table = $('#table').DataTable({
        "paging": false,  // Desactivamos la paginación de DataTables
        "info": false,     // Desactivamos el info de DataTables
        "searching": true  // Mantenemos la búsqueda
      });
    });
  </script>
{% endblock %}
